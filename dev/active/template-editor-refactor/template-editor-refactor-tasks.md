# 템플릿 편집기 리팩토링 - 작업 목록

> **최종 업데이트**: 2026-02-04

---

## Phase 1: 기반 구조 [노력: M] ✅

### 1.1 템플릿 저장소 시스템

- [x] **T1.1.1** 기본 템플릿 디렉토리 구조 변경 [S]
  - `templates/` → `templates/_builtin/` 으로 기존 템플릿 이동
  - `templates/user/` 디렉토리 생성
  - **수락 기준**: 기존 템플릿이 새 위치에서 정상 로드됨
  - **의존성**: 없음

- [x] **T1.1.2** TemplateStorage 클래스 구현 [M]
  - 기본/사용자 템플릿 분리 관리
  - CRUD 메서드 (create, read, update, delete)
  - 템플릿 복사 기능
  - **수락 기준**: 모든 CRUD 테스트 통과
  - **의존성**: T1.1.1

- [x] **T1.1.3** TemplateManager 확장 [S]
  - TemplateStorage 통합
  - 기존 API 호환성 유지
  - **수락 기준**: 기존 테스트 통과 + 새 기능 테스트 통과
  - **의존성**: T1.1.2

- [x] **T1.1.4** meta.json 스키마 정의 및 처리 [S]
  - 메타데이터 파일 구조 정의
  - 읽기/쓰기 유틸리티
  - **수락 기준**: 메타데이터 저장/로드 테스트 통과
  - **의존성**: T1.1.2

### 1.2 상단 메인 툴바 (스켈레톤 분석기 스타일)

- [x] **T1.2.1** MainToolbar 기본 구조 구현 [M]
  - QToolBar 상속
  - 기능별 버튼 그룹 레이아웃
  - QFrame separator로 그룹 분리
  - **수락 기준**: 툴바 표시 정상, 그룹 분리 시각적 확인
  - **의존성**: 없음

- [x] **T1.2.2** 파일 그룹 버튼 구현 [S]
  - [열기] 버튼: 엑셀 파일 열기 (Ctrl+O)
  - [저장] 버튼: 템플릿 저장 (Ctrl+S)
  - **수락 기준**: 버튼 클릭 시 시그널 발생, 단축키 동작
  - **의존성**: T1.2.1

- [x] **T1.2.3** 데이터 시트 그룹 버튼 구현 [M]
  - [표시/숨김] 토글 버튼: 체크 가능 (Ctrl+D)
  - [새로고침] 버튼 (F5)
  - **수락 기준**: 토글 시 데이터 시트 표시/숨김 전환
  - **의존성**: T1.2.1

- [x] **T1.2.4** 템플릿 그룹 구현 [M]
  - 템플릿 선택 드롭다운 (QComboBox)
  - [새로 만들기] 버튼 (Ctrl+N)
  - [관리] 버튼
  - **수락 기준**: 드롭다운 선택, 버튼 클릭 시그널 발생
  - **의존성**: T1.2.1, T1.1.3

- [x] **T1.2.5** 편집 모드 그룹 구현 [S]
  - 라디오 버튼 스타일 (QButtonGroup)
  - [편집] [미리보기] [매핑] 3가지 모드
  - 단축키: Ctrl+E, Ctrl+P, Ctrl+M
  - **수락 기준**: 모드 전환 시 시그널 발생
  - **의존성**: T1.2.1

- [x] **T1.2.6** 뷰 그룹 구현 [S]
  - 줌 드롭다운 (50%, 75%, 100%, 125%, 150%, 200%)
  - [전체화면] 버튼 (F11)
  - **수락 기준**: 줌 변경, 전체화면 토글 동작
  - **의존성**: T1.2.1

### 1.3 메인 윈도우 레이아웃 변경

- [x] **T1.3.1** MainWindow 레이아웃 리팩토링 [M]
  - 상단: MainToolbar (고정)
  - 중간: 데이터 시트 (토글 가능)
  - 하단: 템플릿 편집기 영역
  - **수락 기준**: 레이아웃 전환 정상, 기존 기능 유지
  - **의존성**: T1.2.1 ~ T1.2.6

- [x] **T1.3.2** 데이터 시트 토글 연동 [S]
  - 툴바 버튼 ↔ ExcelViewer 가시성 연동
  - 숨김 시 상태바에 파일명, 행 수 표시
  - **수락 기준**: 토글 즉시 반영, 상태바 정보 정확
  - **의존성**: T1.3.1, T1.2.3

---

## Phase 2: 템플릿 편집기 [노력: L] ✅

### 2.1 편집기 기본 구조

- [x] **T2.1.1** template_editor 모듈 구조 생성 [S]
  - `src/ui/template_editor/` 디렉토리 생성
  - `__init__.py` 작성
  - **수락 기준**: 모듈 임포트 성공
  - **의존성**: 없음

- [x] **T2.1.2** EditorWidget 기본 골격 구현 [M]
  - 컨텐츠 영역만 (스택 위젯)
  - MainToolbar와 시그널 연결
  - **수락 기준**: 레이아웃 표시 정상, 툴바 연동
  - **의존성**: T2.1.1, T1.2.1

- [x] **T2.1.3** MainToolbar ↔ EditorWidget 연동 [S]
  - 템플릿 선택 시 EditorWidget 업데이트
  - 모드 변경 시 EditorWidget 모드 전환
  - 줌/전체화면 시 EditorWidget 적용
  - **수락 기준**: 툴바 조작 → 편집기 반영
  - **의존성**: T1.2.4, T1.2.5, T1.2.6, T2.1.2

### 2.2 편집 모드

- [x] **T2.2.1** HTML 편집 뷰 구현 [M]
  - QPlainTextEdit 기반
  - 기본 편집 기능 (복사, 붙여넣기, 실행취소)
  - **수락 기준**: HTML 편집 가능
  - **의존성**: T2.1.2

- [x] **T2.2.2** 편집 내용 변경 감지 [S]
  - 수정 상태 플래그 관리
  - **수락 기준**: 변경 감지 정확
  - **의존성**: T2.2.1

### 2.3 미리보기 모드

- [x] **T2.3.1** 미리보기 뷰 구현 [M]
  - QWebEngineView 재사용/확장
  - Jinja2 렌더링 통합
  - 현재 선택된 엑셀 행 데이터로 렌더링
  - **수락 기준**: 렌더링 정상, 데이터 바인딩 정확
  - **의존성**: T2.1.2

- [x] **T2.3.2** 실시간 미리보기 업데이트 [S]
  - 템플릿 변경 시 자동 업데이트
  - **수락 기준**: 변경 시 즉시 반영
  - **의존성**: T2.3.1

### 2.4 모드 전환

- [x] **T2.4.1** 모드 전환 UI 구현 [S]
  - 스택 위젯으로 뷰 전환
  - **수락 기준**: 모드 전환 즉시 반영
  - **의존성**: T2.2.1, T2.3.1

- [x] **T2.4.2** 전체화면 토글 구현 [S]
  - F11 단축키 지원
  - **수락 기준**: 전체화면 진입/해제 정상
  - **의존성**: T2.4.1

### 2.5 템플릿 관리 다이얼로그

- [x] **T2.5.1** TemplateManagerDialog 구현 [M]
  - 기본 템플릿 목록 (복사 버튼)
  - 사용자 템플릿 목록 (편집/복사/삭제)
  - 새 템플릿 만들기 버튼
  - **수락 기준**: 모든 CRUD 동작 정상
  - **의존성**: T1.1.2

- [x] **T2.5.2** 템플릿 가져오기/내보내기 [S]
  - ZIP 형식으로 내보내기 (html + mapping.json + meta.json)
  - ZIP 파일 가져오기
  - **수락 기준**: 내보내기/가져오기 왕복 테스트 통과
  - **의존성**: T2.5.1

---

## Phase 3: 위지윅 매핑 [노력: L] ✅

### 3.1 매핑 오버레이

- [x] **T3.1.1** MappingOverlay 기본 구현 [M]
  - 미리보기 위에 투명 오버레이
  - 클릭 이벤트 캡처
  - 클릭 위치 좌표 계산
  - **수락 기준**: 클릭 이벤트 정확히 캡처
  - **의존성**: T2.3.1

- [x] **T3.1.2** 플레이스홀더 하이라이트 [M]
  - 기존 `{{ field }}` 위치 감지
  - 하이라이트 박스 표시
  - 호버 시 필드명 툴팁
  - **수락 기준**: 모든 플레이스홀더 정확히 표시
  - **의존성**: T3.1.1

### 3.2 필드 선택 팝업

- [x] **T3.2.1** FieldPicker 팝업 구현 [M]
  - 엑셀 컬럼 목록 표시
  - 검색/필터 기능
  - 클릭 시 플레이스홀더 삽입
  - **수락 기준**: 필드 선택 → 삽입 정상 동작
  - **의존성**: T3.1.1

- [x] **T3.2.2** 플레이스홀더 삽입 로직 [M]
  - HTML 내 클릭 위치에 `{{ field_id }}` 삽입
  - **수락 기준**: 삽입 후 HTML 정확히 업데이트
  - **의존성**: T3.2.1, T2.2.1

### 3.3 매핑 모드 통합

- [x] **T3.3.1** 매핑 모드 UI 통합 [M]
  - 왼쪽: 필드 목록 패널
  - 오른쪽: 미리보기 + 오버레이
  - **수락 기준**: 매핑 모드 전체 워크플로우 동작
  - **의존성**: T3.1.2, T3.2.2

- [x] **T3.3.2** FieldListWidget 구현 [S]
  - 필드 목록에 매핑 상태 표시 (✓/✗)
  - 검색 기능
  - **수락 기준**: 필드 목록 정확히 표시
  - **의존성**: T3.3.1

---

## Phase 4: 고급 기능 [노력: M] ✅

### 4.1 편의 기능

- [x] **T4.1.1** 실행 취소/다시 실행 구현 [M]
  - QUndoStack 사용
  - 편집 작업 지원
  - **수락 기준**: Ctrl+Z/Ctrl+Y 정상 동작
  - **의존성**: T2.2.1

- [x] **T4.1.2** 키보드 단축키 추가 [S]
  - Ctrl+S: 저장
  - Ctrl+Z: 실행 취소
  - Ctrl+Y: 다시 실행
  - **수락 기준**: 모든 단축키 동작
  - **의존성**: T2.4.1

### 4.2 저장 안정성

- [x] **T4.2.1** 자동 저장 구현 [S]
  - 일정 간격 자동 저장 (설정 가능)
  - 임시 파일에 저장 후 교체
  - **수락 기준**: 자동 저장 정상, 데이터 손실 없음
  - **의존성**: T2.2.2

- [x] **T4.2.2** 백업 및 복구 [S]
  - 저장 전 이전 버전 백업
  - 최근 N개 버전 유지
  - **수락 기준**: 백업 파일 생성, 복구 가능
  - **의존성**: T4.2.1

---

## 테스트 작업

### 단위 테스트

- [x] **TT1** TemplateStorage 테스트 작성 [S] ✓ 22/22 통과
  - **파일**: `tests/test_template_storage.py`

- [x] **TT2** MainToolbar 테스트 작성 [S] ✓ 39/39 통과
  - **파일**: `tests/test_main_toolbar.py`

- [x] **TT3** EditorWidget 테스트 작성 [M]
  - **파일**: `tests/test_editor_widget.py`
  - **참고**: 일부 GUI 테스트는 환경에 따라 segfault 발생 가능

- [x] **TT4** MappingOverlay 테스트 작성 [M] ✓ 17/17 통과
  - **파일**: `tests/test_mapping_overlay.py`

### 통합 테스트

- [x] **TT5** 템플릿 CRUD 통합 테스트 [M] ✓ 18/18 통과
  - **파일**: `tests/test_template_crud_integration.py`

- [x] **TT6** 편집→미리보기→저장 워크플로우 테스트 [M]
  - **파일**: `tests/test_editor_workflow.py`
  - **참고**: GUI 테스트는 환경에 따라 실행 결과 다를 수 있음

- [x] **TT7** 매핑 워크플로우 테스트 [M]
  - **파일**: `tests/test_mapping_workflow.py`

---

## 진행 상황 요약

| Phase | 완료 | 진행중 | 대기 | 합계 |
|-------|------|--------|------|------|
| Phase 1 | 12 | 0 | 0 | 12 |
| Phase 2 | 12 | 0 | 0 | 12 |
| Phase 3 | 6 | 0 | 0 | 6 |
| Phase 4 | 4 | 0 | 0 | 4 |
| 테스트 | 7 | 0 | 0 | 7 |
| **합계** | **41** | **0** | **0** | **41** |
